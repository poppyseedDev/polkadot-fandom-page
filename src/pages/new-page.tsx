import Head from 'next/head'
import Image from 'next/image'
import { Inter } from 'next/font/google'
import styles from '@/styles/Home.module.css'
import { InferGetStaticPropsType } from 'next'
import ProductCard from '@/components/ProductCard'

import { extendFields, getClient } from '@kodadot1/uniquery'

interface Metadata {
  name: string;
  description: string;
  image: string;
  external_url?: string;
  animation_url?: string;
}

interface Item {
  id: string;
  createdAt: Date;
  name: string;
  metadata: string;
  currentOwner: string;
  image?: string;
  meta?: Metadata;
  price: bigint;
  issuer: string;
}

export type GraphLike<T> = { data: T } | T

export type  Data = GraphLike<{ items: Item[]; } | null>

export const getStaticProps = async () => {
  const client = getClient('bsx')
  const id = '2551182625'
  const query = client.itemListByCollectionId(id, {
    fields: extendFields(['meta', 'price']),
    orderBy: 'createdAt_ASC',
  })
  const res: Data = await client.fetch(query)

  let itemam: {
    items: Item[]
  } | null 

  let items: Item[] | undefined

  if (res) {
    if ('data' in res) {
      itemam = res.data
    } else {
      itemam = res
    }
    items = itemam?.items;
  }

  return {
    props: { items }
  }
}


export default function Home({ items }: InferGetStaticPropsType<typeof getStaticProps> ) {
  if (typeof items == "undefined") {
    return (
      <>
       Data unaccessible
      </>
    )
  }

  console.log(items)

  return (
    <>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className={styles.main}>
      <div
        className="w-11/12 max-w-5xl mx-auto mt-28"
        aria-labelledby="information-heading"
      >
        <h2 id="information-heading" className="sr-only">
          Product List
        </h2>
        <div className="grid grid-cols-1 gap-8 sm:!gap-x-10 sm:!grid-cols-2 lg:!grid-cols-3 lg:!gap-x-12 lg:!gap-y-10">
          {items.map( item => (<ProductCard key={item.id} item={item} />))}
        </div>
      </div>
      </main>
    </>
  )
}
